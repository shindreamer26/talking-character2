<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ã‚­ãƒ£ãƒ©ã‚¢ãƒ—ãƒª</title>
  <style>
    :root { --bg:#fff7fb; --panel:#ffffff; --text:#222; --muted:#666; --accent:#ff4fa1; --line:#e9e9e9; }
    html,body{height:100%;}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;background:linear-gradient(160deg,var(--bg),#f0fbff);color:var(--text);}
    .wrap{max-width:720px;margin:0 auto;padding:18px 14px 24px;box-sizing:border-box;}
    h1{margin:4px 0 14px;font-size:20px;font-weight:700;}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 20px rgba(0,0,0,.06);overflow:hidden;}
    .hero{display:flex;gap:14px;align-items:flex-start;padding:14px;}
    .imgbox{width:120px;height:120px;border-radius:16px;background:#f2f2f2;border:1px solid var(--line);display:flex;align-items:center;justify-content:center;overflow:hidden;flex:0 0 auto;}
    .imgbox img{width:100%;height:100%;object-fit:cover;display:block;}
    .bubble{flex:1 1 auto;min-height:120px;border-radius:16px;background:#fff;border:1px solid var(--line);padding:12px 12px 10px;position:relative;}
    .bubble:before{content:"";position:absolute;left:-10px;top:24px;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-right:10px solid #fff;}
    .bubble:after{content:"";position:absolute;left:-11px;top:24px;width:0;height:0;border-top:10px solid transparent;border-bottom:10px solid transparent;border-right:10px solid var(--line);}
    .bubble .label{font-size:12px;color:var(--muted);margin-bottom:8px;}
    .bubble .say{font-size:16px;line-height:1.6;white-space:pre-wrap;}
    .controls{padding:12px 14px 14px;border-top:1px solid var(--line);display:grid;gap:10px;}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .row label{font-size:12px;color:var(--muted);min-width:44px;}
    input[type="range"]{flex:1 1 200px;}
    .pill{font-size:12px;color:var(--muted);}
    .btn{border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 12px;font-size:14px;cursor:pointer;}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff;font-weight:700;}
    .btn:active{transform:translateY(1px);}
    .input{flex:1 1 280px;border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-size:14px;outline:none;}
    .tiny{font-size:12px;color:var(--muted);line-height:1.5;}
    .toast{display:none;margin-top:8px;padding:10px 12px;border-radius:12px;background:#fff3f9;border:1px solid #ffd1e6;color:#b3005a;font-size:12px;}
    .toast.show{display:block;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ã‚­ãƒ£ãƒ©ã‚¢ãƒ—ãƒª</h1>
<div class="card">
  <div class="hero">
    <div class="imgbox">
      <img id="chImg" src="character.png" alt="character" onerror="this.style.display='none';this.parentElement.textContent='ç”»åƒãªã—';" />
    </div>
    <div class="bubble">
      <div class="label">ã“ã“ã«ã‚»ãƒªãƒ•ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆ</div>
      <div id="say" class="say">ã‚„ã£ã»ãƒ¼ï¼ã‚ˆã†ã“ãå¤¢ã®ãƒ€ã‚¸ãƒ£ãƒ¬ãƒ©ãƒ³ãƒ‰ã¸ï¼ã¾ãšã¯ä½•ã§ã‚‚è©±ã—ã‹ã‘ã¦ã¿ã¦ãªï¼</div>
    </div>
  </div>

  <div class="controls">
    <div class="row">
      <label>é€Ÿåº¦</label>
      <input id="rate" type="range" min="0.6" max="1.6" step="0.1" value="1.0" />
      <span id="rateV" class="pill">1.0</span>
      <label style="min-width:36px;">é«˜ã•</label>
      <input id="pitch" type="range" min="0.7" max="1.7" step="0.1" value="1.2" />
      <span id="pitchV" class="pill">1.2</span>
      <button id="toggleVoice" class="btn">éŸ³å£°ON</button>
    </div>

    <div class="row">
      <input id="text" class="input" placeholder="ã“ã“ã«å…¥åŠ›ã—ã¦é€ä¿¡ï¼ˆEnterã§ã‚‚OKï¼‰" />
      <button id="send" class="btn primary">é€ä¿¡</button>
      <button id="random" class="btn">ãƒ©ãƒ³ãƒ€ãƒ å°è©</button>
    </div>

    <div id="toast" class="toast">iPhoneã‚„LINEå†…ãƒ–ãƒ©ã‚¦ã‚¶ã ã¨éŸ³ãŒå‡ºãªã„æ™‚ãŒã‚ã‚‹ã‚ˆã€‚Safari/Chromeã§é–‹ã„ã¦ã¿ã¦ã­ã€‚</div>
    <div class="tiny">ã‚³ãƒ„ï¼šæœ€åˆã®1å›ã ã‘ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦éŸ³å£°ã‚’è§£æ”¾ã—ã¦ã­ï¼ˆiPhoneå¯¾ç­–ï¼‰ã€‚</div>
  </div>
</div> 
 </div>
 <script>
  const sayEl = document.getElementById("say");
  const textEl = document.getElementById("text");
  const rateEl = document.getElementById("rate");
  const pitchEl = document.getElementById("pitch");
  const rateV = document.getElementById("rateV");
  const pitchV = document.getElementById("pitchV");
  const toast = document.getElementById("toast");
  const toggleVoiceBtn = document.getElementById("toggleVoice");

  let voiceEnabled = true;
  let unlocked = false;

  const PHRASES_RANDOM = [
    "ã‚ˆã†ã“ãã€œï¼ä»Šæ—¥ã‚‚çµ¶å¥½èª¿ã§ã€ãœã£ã“ã†ã¡ã‚‡ã€œï¼",
    "è¿·å­ï¼Ÿå¤§ä¸ˆå¤«ã€‚ã¾ã‚ˆã‚ãšã€ã¾ã‚ˆãˆã‚‹ã®ãŒãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ï¼",
    "ãŠè…¹ã™ã„ãŸï¼Ÿãã‚Œãªã‚‰â€¦ãŠãªã‹ã‚¹ã‚¤ãƒ¼ãƒˆï¼",
    "å…ƒæ°—ãªã„ï¼Ÿå…ƒæ°—ã‚’å‡ºã—ã¦â€¦ã’ã‚“ãå‡ºã—ã¦â€¦ã’ã‚“ãå‡ºã—äº­ï¼",
    "ä»Šæ—¥ã¯æ™´ã‚Œï¼Ÿã¯ã‚Œï¼Ÿâ€¦ã¯ã‚Œã€œï¼ãƒ‘ãƒ¬ãƒ¼ãƒ‰è¡Œã“ï¼",
    "ç–²ã‚ŒãŸã‚‰ä¼‘æ†©ï¼ãã‚…ã†ã‘ã„ã¯â€¦ãã‚…ã†ã‘ã„ç‹ï¼",
    "å†™çœŸæ’®ã‚ï¼ã¯ã„ãƒãƒ¼ã‚ºâ€¦ã¡ãƒ¼ãšã£ã¨ç¬‘é¡”ã§ï¼",
    "ãŠåœŸç”£ã¯ï¼ŸãŠã¿ã‚„ã’ã¯â€¦ãŠã¿ã‚„ã’ã£ã¨ï¼",
    "ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼Ÿã‚ã£ã¨é©šãâ€¦ã‚¢ãƒˆãƒ©ãƒƒã‚­ãƒ¥ãƒ¼ãƒ³ï¼",
    "ä¸¦ã¶ã®ã—ã‚“ã©ã„ï¼Ÿã§ã‚‚ä¸¦ã¹ã°â€¦ãªã‚‰ã¹ã°â€¦ãªã‚‰ã¹ã‚‹å ´ï¼",
    "ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸Šã’ã¦ã“ï¼ä¸Šã’ã‚‹ã ã‘ã«â€¦ã‚¢ã‚²ã‚¢ã‚²ãƒ«ï¼",
    "ãã¿ã®ç¬‘é¡”ãŒä¸»å½¹ï¼ãˆãŒãŠâ€¦ãˆãƒ¼ãŒâ€¦ãŠï¼",
    "å¤¢ã¯ã§ã£ã‹ãï¼ã‚†ã‚ã ã‘ã«â€¦ã‚†ã‚ã„ã£ã±ã„ï¼",
    "æ€–ã„ã®è‹¦æ‰‹ï¼Ÿã ã„ã˜ã‚‡ã¶ã€ã“ã‚ããªã„â€¦ã“ã‚ããƒŠã‚¤ãƒˆï¼",
    "æœ€å¾Œã¾ã§æ¥½ã—ã‚‚ã†ï¼ã•ã„ã”ã¾ã§â€¦ã•ã„ã“ãƒ¼ã¾ã§ï¼"
  ];

  function detectContext(t){
    const s = (t || "").toLowerCase();
    if (/(ã‚ã‚ŠãŒã¨ã†|åŠ©ã‹ã£ãŸ|æ„Ÿè¬|thx|thanks)/.test(s)) return "thanks";
    if (/(ç–²ã‚Œ|ã—ã‚“ã©|ã ã‚‹|ã¤ã‹ã‚Œ|çœ |ã­ã‚€)/.test(s)) return "tired";
    if (/(ã“ã‚“ã«ã¡ã¯|ã“ã‚“ã¡ã¯|ã“ã‚“ã°ã‚“ã¯|ãŠã¯ã‚ˆ|ã‚„ã‚|ã¯ã˜ã‚ã¾ã—ã¦|ã©ã†ã‚‚|hi|hello)/.test(s)) return "greeting";
    if (/(ã‚€ã‹ã¤|ã‚¤ãƒ©|ã†ã–|ã—ã­|æœ€æ‚ª)/.test(s)) return "angry";
    if (/(å¥½ã|ã‹ã‚ã„ã„|æ¨ã—|æœ€é«˜|ã„ã„ã­)/.test(s)) return "praise";
    return "normal";
  }

  function makeReply(userText){
    const c = detectContext(userText);

    if(c==="greeting"){
      return "ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ãƒ¼ï¼ã“ã“ã¯å¤¢ã®ãƒ€ã‚¸ãƒ£ãƒ¬ãƒ©ãƒ³ãƒ‰ï¼ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã¯ãƒ†ãƒ³ã‚·ãƒ§ãƒ³â€¦ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸Šã’ã‚·ãƒ§ãƒ¼ãƒ³ã§ã„ãã§ï¼";
    }
    if(c==="thanks"){
      return "ã©ã†ã„ãŸã—ã¾ã—ã¦ï¼æ„Ÿè¬ã®æ°—æŒã¡ã¯è¦³è¦§è»Šã®ã‚ˆã†ã«ã€ãã‚‹ãã‚‹å›ã£ã¦è¿”ã£ã¦ãã‚‹ã§ï¼";
    }
    if(c==="tired"){
      return "ãŠç–²ã‚Œæ§˜ã‚„ã§ï¼ã“ã“ã§ä¸€æ¯ã€ã²ã¨ã‚„ã™ã¿ã—ã¦â€¦ãƒ’ãƒˆãƒ¤ã‚¹ãƒŸãƒ¥ãƒ¼ã‚¸ã‚¢ãƒ æ°—åˆ†ã§ã„ã“ï¼";
    }
    if(c==="angry"){
      return "ãŠã£ã¨ç†±ããªã£ã¦ã‚‹ï¼Ÿã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã—ã‚ˆã€‚æ€’ã‚Šã¯ç½®ã„ã¦â€¦ãŠã“ã‚Šã¯ãŠã“ã‚‰ãšã€ã»ã£ã“ã‚Šè¡Œã“ã†ï¼";
    }
    if(c==="praise"){
      return "ã†ã‚Œã—ãƒ¼ï¼è¤’ã‚è¨€è‘‰ã¯ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³ã¿ãŸã„ã«å¼¾ã‘ã‚‹ãªï¼ã½ã£ã·ï¼ã“ãƒ¼ã‚“ï¼";
    }

    const jokes = [
      "ãªã‚‹ã»ã©ãªï¼ãã‚Œã€ãªã‚‹ã»ã©â€¦ãªã‚‹ã»ã©ãƒ¼ã‚“ï¼",
      "ãã‚Œã¯åæ¡ˆï¼ã‚ã„ã‚ã‚“ã ã‘ã«â€¦ã‚ã„ã‚¢ãƒ³ãƒ‘ãƒ³ï¼",
      "äº†è§£ï¼äº†è§£ã ã‘ã«â€¦ã‚Šã‚‡ãƒ¼ã‹ã„ã‚‚ã®ï¼",
      "èã„ãŸã§ï¼ãã„ãŸã§â€¦ããƒ¼ãŸã‚“ã§ï¼",
      "ä»»ã›ã¦ï¼ã¾ã‹ã›ã¦â€¦ã¾ã‹ã›äº­ï¼"
    ];

    const reactions = [
      "ãƒ¯ã‚¯ãƒ¯ã‚¯ãŒæ­¢ã¾ã‚‰ã‚“ï¼",
      "ãã‚Œã€ã‚ã£ã¡ã‚ƒãˆãˆã‚„ã‚“ï¼",
      "ãƒ„ãƒƒã‚³ã¾ã›ã¦ï¼ã£ã¦æ€ã£ãŸã‘ã©ã€ä»Šæ—¥ã¯å„ªã—ã‚ã§ã„ãã‚ï¼",
      "ã»ãªè¡Œã“ã‹ã€ãã®è©±ï¼",
      "ãã®ç™ºæƒ³ã€ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ç´šï¼"
    ];

    const emoji = ["âœ¨","ğŸ¡","ğŸ ","ğŸ¿","ğŸˆ","ğŸŒˆ","ğŸ¢"];
    const pick = a => a[Math.floor(Math.random()*a.length)];

    return pick(reactions) + " " + pick(jokes) + " " + pick(emoji);
  }

  function speak(text){
    if(!voiceEnabled) return;
    if(!("speechSynthesis" in window)) return;

    window.speechSynthesis.cancel();

    const u = new SpeechSynthesisUtterance(text);
    u.lang = "ja-JP";
    u.rate = parseFloat(rateEl.value);
    u.pitch = parseFloat(pitchEl.value);

    const voices = window.speechSynthesis.getVoices();
    const ja = voices.find(v => v.lang && v.lang.toLowerCase().includes("ja"));
    if(ja) u.voice = ja;

    window.speechSynthesis.speak(u);
  }

  function show(text){
    sayEl.textContent = text;
    speak(text);
  }

  function unlockAudioOnce(){
    if(unlocked) return;
    try{
      const u = new SpeechSynthesisUtterance(" ");
      u.volume = 0;
      window.speechSynthesis.speak(u);
    }catch(e){}
    unlocked = true;
  }

  function isInAppBrowser(){
    const ua = navigator.userAgent || "";
    return /Line\/|FBAN|FBAV|Instagram|Twitter|TikTok/.test(ua);
  }

  function handleSend(){
    unlockAudioOnce();
    const t = (textEl.value || "").trim();
    if(!t){
      show("ç©ºã£ã½ã¯ã‚ã‹ã‚“ã§ï¼ã§ã‚‚å¤§ä¸ˆå¤«ã€ç©ºã£ã½ã ã‘ã«â€¦ã‹ã‚‰ã£ã½ãƒ¼ã‚“ï¼ä½•ã‹å…¥ã‚Œã¦é€ã£ã¦ãªï¼");
      return;
    }
    const reply = makeReply(t);
    show(reply);
    textEl.value = "";
  }

  function handleRandom(){
    unlockAudioOnce();
    const r = PHRASES_RANDOM[Math.floor(Math.random()*PHRASES_RANDOM.length)];
    show(r);
  }

  rateEl.addEventListener("input", ()=> rateV.textContent = rateEl.value);
  pitchEl.addEventListener("input", ()=> pitchV.textContent = pitchEl.value);

  document.getElementById("send").addEventListener("click", handleSend);
  document.getElementById("random").addEventListener("click", handleRandom);
  textEl.addEventListener("keydown", (e)=>{
    if(e.key==="Enter"){
      e.preventDefault();
      handleSend();
    }
  });

  toggleVoiceBtn.addEventListener("click", ()=>{
    voiceEnabled = !voiceEnabled;
    toggleVoiceBtn.textContent = voiceEnabled ? "éŸ³å£°ON" : "éŸ³å£°OFF";
    if(!voiceEnabled) window.speechSynthesis.cancel();
  });

  if(isInAppBrowser()){
    toast.classList.add("show");
  }
</script>
</body>
</html>
